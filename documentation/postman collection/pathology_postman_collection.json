{
	"info": {
		"_postman_id": "911c062e-e62e-4760-affb-6eb4c32e13eb",
		"name": "Pathology",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "43320361",
		"_collection_link": "https://planetary-spaceship-644674.postman.co/workspace/Pathology-API~4765cacd-acf2-409e-8c8c-ea0436349e2e/collection/30536314-911c062e-e62e-4760-affb-6eb4c32e13eb?action=share&source=collection_link&creator=43320361"
	},
	"item": [
		{
			"name": "Adapter Container",
			"item": [
				{
					"name": "_info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://{{domain}}:{{adaptor_port}}/info",
							"protocol": "http",
							"host": [
								"{{domain}}"
							],
							"port": "{{adaptor_port}}",
							"path": [
								"info"
							]
						},
						"description": "Generated from cURL: curl -i --location --request GET 'http://localhost:8080/healthcheck'"
					},
					"response": []
				},
				{
					"name": "_healthcheck",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://{{domain}}:{{adaptor_port}}/healthcheck",
							"protocol": "http",
							"host": [
								"{{domain}}"
							],
							"port": "{{adaptor_port}}",
							"path": [
								"healthcheck"
							]
						},
						"description": "# Description\n\nThis endpoint verifies that the adaptor's healthcheck endpoint is available.\n\n# Example Response\n\n``` json\n{\n  \"status\": \"UP\"\n}\n ```"
					},
					"response": []
				},
				{
					"name": "_metrics",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://{{domain}}:{{adaptor_port}}/metrics",
							"protocol": "http",
							"host": [
								"{{domain}}"
							],
							"port": "{{adaptor_port}}",
							"path": [
								"metrics"
							]
						},
						"description": "# Description\n\nReturns a list of available spring boot metric from the adapter.\n\n# Example Response\n\n``` json\n{\n    \"names\": [\n        \"http.server.requests\",\n        \"jvm.buffer.count\",\n        \"jvm.buffer.memory.used\",\n        \"jvm.buffer.total.capacity\",\n        \"jvm.classes.loaded\",\n        \"jvm.classes.unloaded\",\n        \"jvm.gc.live.data.size\",\n        \"jvm.gc.max.data.size\",\n        \"jvm.gc.memory.allocated\",\n        \"jvm.gc.memory.promoted\",\n        \"jvm.gc.pause\",\n        \"jvm.memory.committed\",\n        \"jvm.memory.max\",\n        \"jvm.memory.used\",\n        \"jvm.threads.daemon\",\n        \"jvm.threads.live\",\n        \"jvm.threads.peak\",\n        \"jvm.threads.states\",\n        \"logback.events\",\n        \"process.cpu.usage\",\n        \"process.files.max\",\n        \"process.files.open\",\n        \"process.start.time\",\n        \"process.uptime\",\n        \"spring.data.repository.invocations\",\n        \"system.cpu.count\",\n        \"system.cpu.usage\",\n        \"system.load.average.1m\",\n        \"tomcat.sessions.active.current\",\n        \"tomcat.sessions.active.max\",\n        \"tomcat.sessions.alive.max\",\n        \"tomcat.sessions.created\",\n        \"tomcat.sessions.expired\",\n        \"tomcat.sessions.rejected\"\n    ]\n}\n\n ```\n\n# Further Usage\n\nTo get the value of a particulat metric, paste the metric you wish to see at the end of the request.\n\nFor example:  \nTo see the `system.cpu.usage`, you must perform a GET request to `http://{{domain}}:{{adaptor_port}}/metrics/system.cpu.usage`"
					},
					"response": []
				}
			]
		},
		{
			"name": "Inbound Queue",
			"item": [
				{
					"name": "Authorization",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uuid = require('uuid');",
									"const moment = require('moment');",
									"const mailboxId = pm.environment.get(\"mailbox-id\");",
									"const mailboxPassword = pm.environment.get(\"mailbox-password\");",
									"const sharedKey = pm.environment.get(\"shared-key\");",
									"",
									"const nonce = uuid.v4();",
									"const nonceCount = '001';",
									"const timestamp = moment().utc().format(\"YYYYMMDDHHmm\");",
									"const hashContent = `${mailboxId}:${nonce}:${nonceCount}:${mailboxPassword}:${timestamp}`;",
									"",
									"calculateHmac(sharedKey, hashContent).then(",
									"  hashValue => {",
									"    const token = `NHSMESH ${mailboxId}:${nonce}:${nonceCount}:${timestamp}:${hashValue}`;",
									"    pm.variables.set(\"token\", token);",
									"  });",
									"",
									"async function calculateHmac(key, message) {",
									"  const encoder = new TextEncoder();",
									"  const keyData = encoder.encode(key);",
									"  const messageData = encoder.encode(message);",
									"",
									"  const cryptoKey = await crypto.subtle.importKey(",
									"    'raw',",
									"    keyData,",
									"    { name: 'HMAC', hash: { name: 'SHA-256' } },",
									"    false,",
									"    ['sign']",
									"  );",
									"",
									"  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);",
									"  const hashArray = Array.from(new Uint8Array(signature));",
									"  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');",
									"  return hashHex;",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token}}"
							},
							{
								"key": "Mex-ClientVersion",
								"value": "1.0"
							},
							{
								"key": "Mex-JavaVersion",
								"value": "1.7.0_60"
							},
							{
								"key": "Mex-OSArchitecture",
								"value": "Windows 7"
							},
							{
								"key": "Mex-OSName",
								"value": "x86"
							},
							{
								"key": "Mex-OSVersion",
								"value": "6.1"
							}
						],
						"url": {
							"raw": "https://{{domain}}:{{mesh_port}}/messageexchange/{{mailbox-id}}",
							"protocol": "https",
							"host": [
								"{{domain}}"
							],
							"port": "{{mesh_port}}",
							"path": [
								"messageexchange",
								"{{mailbox-id}}"
							]
						},
						"description": "# Description\n\nSends an authentication request to the MESH mailbox specified. Returns 200 if authorized.\n\nThis should be run before other requests, but in our experience, this is not needed.\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Authorization | Authorization token. This gets generated by the script attached to the request. |\n| Mex-ClientVersion | Part of required MESH headers. Denotes the version of the MESH client that is queried. |\n| Mex-JavaVersion | Part of required MESH headers. Denotes the version of Java running on the MESH client that is queried. |\n| Mex-OSArchitecture | Part of required MESH headers. Denotes the OS of the host that is queried. |\n| Mex-OSName | Part of required MESH headers. Denotes the OS type the host that is queried. Usually x86. |\n| Mex-OSVersion | Part of required MESH headers. Denotes the OS version of the host that is queried. |\n\n# Example response\n\n```\nOK\n\n ```"
					},
					"response": []
				},
				{
					"name": "Send",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uuid = require('uuid');",
									"const moment = require('moment');",
									"const mailboxId = pm.environment.get(\"mailbox-id\");",
									"const mailboxPassword = pm.environment.get(\"mailbox-password\");",
									"const sharedKey = pm.environment.get(\"shared-key\");",
									"",
									"const nonce = uuid.v4();",
									"const nonceCount = '001';",
									"const timestamp = moment().utc().format(\"YYYYMMDDHHmm\");",
									"const hashContent = `${mailboxId}:${nonce}:${nonceCount}:${mailboxPassword}:${timestamp}`;",
									"",
									"calculateHmac(sharedKey, hashContent).then(",
									"  hashValue => {",
									"    const token = `NHSMESH ${mailboxId}:${nonce}:${nonceCount}:${timestamp}:${hashValue}`;",
									"    pm.variables.set(\"token\", token);",
									"  });",
									"",
									"async function calculateHmac(key, message) {",
									"  const encoder = new TextEncoder();",
									"  const keyData = encoder.encode(key);",
									"  const messageData = encoder.encode(message);",
									"",
									"  const cryptoKey = await crypto.subtle.importKey(",
									"    'raw',",
									"    keyData,",
									"    { name: 'HMAC', hash: { name: 'SHA-256' } },",
									"    false,",
									"    ['sign']",
									"  );",
									"",
									"  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);",
									"  const hashArray = Array.from(new Uint8Array(signature));",
									"  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');",
									"  return hashHex;",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.set(\"message-id\", JSON.parse(responseBody).messageID)",
									"console.log(\"Message sent to Inbound Queue. MessageID set to: \" + JSON.parse(responseBody).messageID)"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"strictSSL": false
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token}}",
								"type": "text"
							},
							{
								"key": "Mex-From",
								"value": "{{mailbox-id}}",
								"type": "text"
							},
							{
								"key": "Mex-To",
								"value": "{{mailbox-id}}",
								"type": "text"
							},
							{
								"key": "Mex-WorkflowID",
								"value": "PATH_MEDRPT_V3",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/octet-stream",
								"type": "text"
							},
							{
								"key": "Mex-MessageType",
								"value": "DATA",
								"type": "text"
							},
							{
								"key": "Mex-FileName",
								"value": "test-filename.txt",
								"type": "text"
							},
							{
								"key": "Mex-Version",
								"value": "1.0",
								"type": "text"
							},
							{
								"key": "Mex-ClientVersion",
								"value": "1.0",
								"type": "text"
							},
							{
								"key": "Mex-JavaVersion",
								"value": "1.7.0_60",
								"type": "text"
							},
							{
								"key": "Mex-OSArchitecture",
								"value": "Windows 7",
								"type": "text"
							},
							{
								"key": "Mex-OSName",
								"value": "x86",
								"type": "text"
							},
							{
								"key": "Mex-OSVersion",
								"value": "6.1",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "UNA:+.? '\nUNB+UNOC:3+000000004400001:80+000000024600002:80+100301:1751+1015++MEDRPT++1'\nUNH+1+MEDRPT:0:1:RT:NHS003'\nBGM+LSR'\nDTM+137:201002261541:203'\nS01+01'\nNAD+PO+G3380314:900++SCOTT'\nSPR+PRO'\nS01+01'\nNAD+PO+++NORTH DOWN GP'\nSPR+ORG'\nS01+01'\nNAD+MR+G3380314:900++SCOTT'\nSPR+PRO'\nS01+01'\nNAD+MR+D82015:901'\nSPR+ORG'\nS01+01'\nNAD+SLA+++Haematology'\nSPR+DPT'\nS01+01'\nNAD+SLA+++ST JAMES?'S UNIVERSITY HOSPITAL'\nSPR+ORG'\nS02+02'\nGIS+N'\nRFF+SRI:15/CH000037K/200010191704'\nSTS++UN'\nDTM+ISR:201002251541:203'\nS06+06'\nADR++US:FLAT1:59 SANDTOFT ROAD:LEEDS++DN9 1PJ'\nS07+07'\nPNA+PAT+9435492908:OPI+++SU:AZIZ+FO:NISMA'\nDTM+329:19450730:102'\nPDI+2'\nS10+10'\nCIN+UN'\nFTX+CID+++TIRED ALL THE TIME, LOW Hb'\nFTX+CID+++COELIAC'\nS16+16'\nSEQ++1'\nSPC+TSP+:::VENOUS BLOOD'\nRFF+STI:CH000037KA'\nDTM+SCO:201002231541:203'\nDTM+SRI:201002241541:203'\nGIS+N'\nINV+MQ+:::B12/FOLATE'\nSEQ++1'\nSTS++FI'\nFTX+SPC+++Results repeated:Low plasma Folate'\nRFF+ASL:1'\nGIS+N'\nINV+MQ+42T..:911::Serum vitamin B12'\nRSL+NV+1001++:::ng/L'\nSTS++FI'\nRFF+ARL:1'\nS20+20'\nRND+U+170+1100'\nGIS+N'\nINV+MQ+42UE.:911::Plasma folate level'\nRSL+++++PA'\nSTS++FI'\nRFF+ARL:1'\nS20+20'\nRND+U+2.0+20.0'\nUNT+41+1'\nUNZ+1+1015'\n",
							"options": {
								"raw": {
									"language": "text"
								}
							}
						},
						"url": {
							"raw": "https://{{domain}}:{{mesh_port}}/messageexchange/{{mailbox-id}}/outbox",
							"protocol": "https",
							"host": [
								"{{domain}}"
							],
							"port": "{{mesh_port}}",
							"path": [
								"messageexchange",
								"{{mailbox-id}}",
								"outbox"
							]
						},
						"description": "# Description\n\nSends a request to the inbound queue, which contains an EDIFACT bundle meant to be converted into a FHIR bundle.\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| token | Authorization token. This gets generated by the script attached to the request. A new one will be generated each time a new request is sent. |\n| mailbox-id | Id of a MESH mailbox to send requests to and from. |\n\n# Headers\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Authorization | Authorization token used to authorize each request. It must be different for each request. |\n| Mex-From | The MESH mailbox ID of the sender of the message. |\n| Mex-To | The MESH mailbox ID of the recipient of the message. |\n| Mex-WorkflowID | MESH workflow ID. For this adapter, the options are: `PATH_MEDRPT_V3` and `SCRN_BCS_MEDRPT_V4`. |\n| Content-Type | Type of the message. For Edifact messages, this is `application/octet-stream`. |\n| Mex-MessageType | Required MESH header. Denotes the type of the message being sent to MESH. For sending EDIFACT messages, the correct value is `DATA`. |\n| Mex-FileName | Required MESH header. Denotes the name of the file that the body contents will be placed into. |\n| Mex-ClientVersion | Part of required MESH headers. Denotes the version of the MESH client that is queried. |\n| Mex-JavaVersion | Part of required MESH headers. Denotes the version of Java running on the MESH client that is queried. |\n| Mex-OSArchitecture | Part of required MESH headers. Denotes the OS of the host that is queried. |\n| Mex-OSName | Part of required MESH headers. Denotes the OS type the host that is queried. Usually x86. |\n| Mex-OSVersion | Part of required MESH headers. Denotes the OS version of the host that is queried. |\n\n# Example Body\n\n```\nUNA:+.? '\nUNB+UNOC:3+000000004400001:80+000000024600002:80+100301:1751+1015++MEDRPT++1'\nUNH+1+MEDRPT:0:1:RT:NHS003'\nBGM+LSR'\nDTM+137:201002261541:203'\nS01+01'\nNAD+PO+G3380314:900++SCOTT'\nSPR+PRO'\nS01+01'\nNAD+PO+++NORTH DOWN GP'\nSPR+ORG'\nS01+01'\nNAD+MR+G3380314:900++SCOTT'\nSPR+PRO'\nS01+01'\nNAD+MR+D82015:901'\nSPR+ORG'\nS01+01'\nNAD+SLA+++Haematology'\nSPR+DPT'\nS01+01'\nNAD+SLA+++ST JAMES?'S UNIVERSITY HOSPITAL'\nSPR+ORG'\nS02+02'\nGIS+N'\nRFF+SRI:15/CH000037K/200010191704'\nSTS++UN'\nDTM+ISR:201002251541:203'\nS06+06'\nADR++US:FLAT1:59 SANDTOFT ROAD:LEEDS++DN9 1PJ'\nS07+07'\nPNA+PAT+9435492908:OPI+++SU:AZIZ+FO:NISMA'\nDTM+329:19450730:102'\nPDI+2'\nS10+10'\nCIN+UN'\nFTX+CID+++TIRED ALL THE TIME, LOW Hb'\nFTX+CID+++COELIAC'\nS16+16'\nSEQ++1'\nSPC+TSP+:::VENOUS BLOOD'\nRFF+STI:CH000037KA'\nDTM+SCO:201002231541:203'\nDTM+SRI:201002241541:203'\nGIS+N'\nINV+MQ+:::B12/FOLATE'\nSEQ++1'\nSTS++FI'\nFTX+SPC+++Results repeated:Low plasma Folate'\nRFF+ASL:1'\nGIS+N'\nINV+MQ+42T..:911::Serum vitamin B12'\nRSL+NV+1001++:::ng/L'\nSTS++FI'\nRFF+ARL:1'\nS20+20'\nRND+U+170+1100'\nGIS+N'\nINV+MQ+42UE.:911::Plasma folate level'\nRSL+++++PA'\nSTS++FI'\nRFF+ARL:1'\nS20+20'\nRND+U+2.0+20.0'\nUNT+41+1'\nUNZ+1+1015'\n\n ```\n\n# Example Response\n\n``` json\n{\"messageID\": \"20250319221728938750_000000250\"}\n\n ```\n\nThe ID of the message created is displayed in the response."
					},
					"response": []
				},
				{
					"name": "Inbox",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uuid = require('uuid');",
									"const moment = require('moment');",
									"const mailboxId = pm.environment.get(\"mailbox-id\");",
									"const mailboxPassword = pm.environment.get(\"mailbox-password\");",
									"const sharedKey = pm.environment.get(\"shared-key\");",
									"",
									"const nonce = uuid.v4();",
									"const nonceCount = '001';",
									"const timestamp = moment().utc().format(\"YYYYMMDDHHmm\");",
									"const hashContent = `${mailboxId}:${nonce}:${nonceCount}:${mailboxPassword}:${timestamp}`;",
									"",
									"calculateHmac(sharedKey, hashContent).then(",
									"  hashValue => {",
									"    const token = `NHSMESH ${mailboxId}:${nonce}:${nonceCount}:${timestamp}:${hashValue}`;",
									"    pm.variables.set(\"token\", token);",
									"  });",
									"",
									"async function calculateHmac(key, message) {",
									"  const encoder = new TextEncoder();",
									"  const keyData = encoder.encode(key);",
									"  const messageData = encoder.encode(message);",
									"",
									"  const cryptoKey = await crypto.subtle.importKey(",
									"    'raw',",
									"    keyData,",
									"    { name: 'HMAC', hash: { name: 'SHA-256' } },",
									"    false,",
									"    ['sign']",
									"  );",
									"",
									"  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);",
									"  const hashArray = Array.from(new Uint8Array(signature));",
									"  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');",
									"  return hashHex;",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token}}"
							},
							{
								"key": "Mex-ClientVersion",
								"value": "1.0"
							},
							{
								"key": "Mex-JavaVersion",
								"value": "1.7.0_60"
							},
							{
								"key": "Mex-OSArchitecture",
								"value": "Windows 7"
							},
							{
								"key": "Mex-OSName",
								"value": "x86"
							},
							{
								"key": "Mex-OSVersion",
								"value": "6.1"
							}
						],
						"url": {
							"raw": "https://{{domain}}:{{mesh_port}}/messageexchange/{{mailbox-id}}/inbox",
							"protocol": "https",
							"host": [
								"{{domain}}"
							],
							"port": "{{mesh_port}}",
							"path": [
								"messageexchange",
								"{{mailbox-id}}",
								"inbox"
							]
						},
						"description": "# Description\n\nSends a request to the inbound queue, and queries the messages currently inside a particular mailbox.\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| token | Authorization token. This gets generated by the script attached to the request. A new one will be generated each time a new request is sent. |\n| mailbox-id | Id of a MESH mailbox to send requests to and from. |\n\n# Headers\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Authorization | Authorization token used to authorize each request. It must be different for each request. |\n| Mex-ClientVersion | Part of required MESH headers. Denotes the version of the MESH client that is queried. |\n| Mex-JavaVersion | Part of required MESH headers. Denotes the version of Java running on the MESH client that is queried. |\n| Mex-OSArchitecture | Part of required MESH headers. Denotes the OS of the host that is queried. |\n| Mex-OSName | Part of required MESH headers. Denotes the OS type the host that is queried. Usually x86. |\n| Mex-OSVersion | Part of required MESH headers. Denotes the OS version of the host that is queried. |\n\n# Example response\n\n``` json\n{\n    \"messages\": [\n        \"20250319222212666323_000000252\"\n    ]\n}\n\n ```\n\nThe response is a list of message IDs currently present in the mailbox. In the example above, the inbox contains one message, which has a message id of `20250319222212666323_000000252`."
					},
					"response": []
				},
				{
					"name": "Ack",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uuid = require('uuid');",
									"const moment = require('moment');",
									"const mailboxId = pm.environment.get(\"mailbox-id\");",
									"const mailboxPassword = pm.environment.get(\"mailbox-password\");",
									"const sharedKey = pm.environment.get(\"shared-key\");",
									"",
									"const nonce = uuid.v4();",
									"const nonceCount = '001';",
									"const timestamp = moment().utc().format(\"YYYYMMDDHHmm\");",
									"const hashContent = `${mailboxId}:${nonce}:${nonceCount}:${mailboxPassword}:${timestamp}`;",
									"",
									"calculateHmac(sharedKey, hashContent).then(",
									"  hashValue => {",
									"    const token = `NHSMESH ${mailboxId}:${nonce}:${nonceCount}:${timestamp}:${hashValue}`;",
									"    pm.variables.set(\"token\", token);",
									"  });",
									"",
									"async function calculateHmac(key, message) {",
									"  const encoder = new TextEncoder();",
									"  const keyData = encoder.encode(key);",
									"  const messageData = encoder.encode(message);",
									"",
									"  const cryptoKey = await crypto.subtle.importKey(",
									"    'raw',",
									"    keyData,",
									"    { name: 'HMAC', hash: { name: 'SHA-256' } },",
									"    false,",
									"    ['sign']",
									"  );",
									"",
									"  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);",
									"  const hashArray = Array.from(new Uint8Array(signature));",
									"  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');",
									"  return hashHex;",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token}}"
							},
							{
								"key": "Mex-ClientVersion",
								"value": "1.0"
							},
							{
								"key": "Mex-JavaVersion",
								"value": "1.7.0_60"
							},
							{
								"key": "Mex-OSArchitecture",
								"value": "Windows 7"
							},
							{
								"key": "Mex-OSName",
								"value": "x86"
							},
							{
								"key": "Mex-OSVersion",
								"value": "6.1"
							}
						],
						"url": {
							"raw": "https://localhost:8829/messageexchange/{{mailbox-id}}/inbox/{{message-id}}/status/acknowledged",
							"protocol": "https",
							"host": [
								"localhost"
							],
							"port": "8829",
							"path": [
								"messageexchange",
								"{{mailbox-id}}",
								"inbox",
								"{{message-id}}",
								"status",
								"acknowledged"
							]
						},
						"description": "# Description\n\nSends a request to the inbound queue, acknowledges one of the messages in a particular inbox. If a message is acknowledged, it will NOT go further in the data flow. It will be removed from the queue without anything further.\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| token | Authorization token. This gets generated by the script attached to the request. A new one will be generated each time a new request is sent. |\n| mailbox-id | ID of a MESH mailbox to send requests to and from. |\n| message-id | ID of the message to be acknowledged. |\n\n# Headers\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Authorization | Authorization token used to authorize each request. It must be different for each request. |\n| Mex-ClientVersion | Part of required MESH headers. Denotes the version of the MESH client that is queried. |\n| Mex-JavaVersion | Part of required MESH headers. Denotes the version of Java running on the MESH client that is queried. |\n| Mex-OSArchitecture | Part of required MESH headers. Denotes the OS of the host that is queried. |\n| Mex-OSName | Part of required MESH headers. Denotes the OS type the host that is queried. Usually x86. |\n| Mex-OSVersion | Part of required MESH headers. Denotes the OS version of the host that is queried. |"
					},
					"response": []
				},
				{
					"name": "Download",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uuid = require('uuid');",
									"const moment = require('moment');",
									"const mailboxId = pm.environment.get(\"mailbox-id\");",
									"const mailboxPassword = pm.environment.get(\"mailbox-password\");",
									"const sharedKey = pm.environment.get(\"shared-key\");",
									"",
									"const nonce = uuid.v4();",
									"const nonceCount = '001';",
									"const timestamp = moment().utc().format(\"YYYYMMDDHHmm\");",
									"const hashContent = `${mailboxId}:${nonce}:${nonceCount}:${mailboxPassword}:${timestamp}`;",
									"",
									"calculateHmac(sharedKey, hashContent).then(",
									"  hashValue => {",
									"    const token = `NHSMESH ${mailboxId}:${nonce}:${nonceCount}:${timestamp}:${hashValue}`;",
									"    pm.variables.set(\"token\", token);",
									"  });",
									"",
									"async function calculateHmac(key, message) {",
									"  const encoder = new TextEncoder();",
									"  const keyData = encoder.encode(key);",
									"  const messageData = encoder.encode(message);",
									"",
									"  const cryptoKey = await crypto.subtle.importKey(",
									"    'raw',",
									"    keyData,",
									"    { name: 'HMAC', hash: { name: 'SHA-256' } },",
									"    false,",
									"    ['sign']",
									"  );",
									"",
									"  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);",
									"  const hashArray = Array.from(new Uint8Array(signature));",
									"  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');",
									"  return hashHex;",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "{{token}}"
							},
							{
								"key": "Mex-ClientVersion",
								"value": "1.0"
							},
							{
								"key": "Mex-JavaVersion",
								"value": "1.7.0_60"
							},
							{
								"key": "Mex-OSArchitecture",
								"value": "Windows 7"
							},
							{
								"key": "Mex-OSName",
								"value": "x86"
							},
							{
								"key": "Mex-OSVersion",
								"value": "6.1"
							}
						],
						"url": {
							"raw": "https://{{domain}}:{{mesh_port}}/messageexchange/{{mailbox-id}}/inbox/{{message-id}}",
							"protocol": "https",
							"host": [
								"{{domain}}"
							],
							"port": "{{mesh_port}}",
							"path": [
								"messageexchange",
								"{{mailbox-id}}",
								"inbox",
								"{{message-id}}"
							]
						},
						"description": "# Description\n\nSends a request to the inbound queue, and downloads the specified message. THIS WILL BE THE EDIFACT MESSAGE SENT ORIGINALLY. Once a message was downloaded, it will be removed from the queue and the data flow.\n\nParameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| token | Authorization token. This gets generated by the script attached to the request. A new one will be generated each time a new request is sent. |\n| mailbox-id | ID of a MESH mailbox to send requests to and from. |\n| message-id | ID of the message to be downloaded. |\n\n# Headers\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Authorization | Authorization token used to authorize each request. It must be different for each request. |\n| Mex-ClientVersion | Part of required MESH headers. Denotes the version of the MESH client that is queried. |\n| Mex-JavaVersion | Part of required MESH headers. Denotes the version of Java running on the MESH client that is queried. |\n| Mex-OSArchitecture | Part of required MESH headers. Denotes the OS of the host that is queried. |\n| Mex-OSName | Part of required MESH headers. Denotes the OS type the host that is queried. Usually x86. |\n| Mex-OSVersion | Part of required MESH headers. Denotes the OS version of the host that is queried. |\n\n# Example response\n\nThe response will be an object containing the data that the message specified contains."
					},
					"response": []
				}
			]
		},
		{
			"name": "Outbound Queue",
			"item": [
				{
					"name": "ActiveMQ Send Message",
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"6599daf3-aa70-4df5-bafb-e9318c6bc988\",\n  \"meta\": {\n    \"lastUpdated\": \"2025-04-01T14:39:42.614+00:00\",\n    \"profile\": [\n      \"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Message-Bundle-1\"\n    ]\n  },\n  \"identifier\": {\n    \"system\": \"https://tools.ietf.org/html/rfc4122\",\n    \"value\": \"edcdcbbe-1cbb-43ed-b7e9-517234048edc\"\n  },\n  \"type\": \"message\",\n  \"entry\": [\n    {\n      \"fullUrl\": \"urn:uuid:41b62b9f-e797-4f1a-ba47-1265dd53d187\",\n      \"resource\": {\n        \"resourceType\": \"MessageHeader\",\n        \"id\": \"41b62b9f-e797-4f1a-ba47-1265dd53d187\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-MessageHeader-2\"\n          ]\n        },\n        \"extension\": [\n          {\n            \"url\": \"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-ITK-MessageHandling-2\",\n            \"extension\": [\n              {\n                \"url\": \"BusAckRequested\",\n                \"valueBoolean\": true\n              },\n              {\n                \"url\": \"InfAckRequested\",\n                \"valueBoolean\": true\n              },\n              {\n                \"url\": \"RecipientType\",\n                \"valueCoding\": {\n                  \"system\": \"https://fhir.nhs.uk/STU3/CodeSystem/ITK-RecipientType-1\",\n                  \"code\": \"FA\",\n                  \"display\": \"For Action\"\n                }\n              },\n              {\n                \"url\": \"SenderReference\",\n                \"valueString\": \"None\"\n              },\n              {\n                \"url\": \"LocalExtension\",\n                \"valueString\": \"None\"\n              }\n            ]\n          }\n        ],\n        \"event\": {\n          \"system\": \"https://fhir.nhs.uk/STU3/CodeSystem/ITK-MessageEvent-2\",\n          \"code\": \"ITK012M\",\n          \"display\": \"ITK National Pathology\"\n        },\n        \"receiver\": {\n          \"reference\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\"\n        },\n        \"sender\": {\n          \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n        },\n        \"timestamp\": \"2010-03-01T17:51:00.000+00:00\",\n        \"source\": {\n          \"endpoint\": \"lab_results_ack_mailbox\"\n        },\n        \"responsible\": {\n          \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n        },\n        \"focus\": [\n          {\n            \"reference\": \"urn:uuid:1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"7487dc19-414a-416a-a795-cb98ecccacd6\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"extension\": [\n              {\n                \"url\": \"https://fhir.hl7.org.uk/STU3/StructureDefinition/Extension-CareConnect-NHSNumberVerificationStatus-1\",\n                \"valueCodeableConcept\": {\n                  \"coding\": [\n                    {\n                      \"system\": \"https://fhir.hl7.org.uk/STU3/CodeSystem/CareConnect-NHSNumberVerificationStatus-1\",\n                      \"code\": \"01\",\n                      \"display\": \"Number present and verified\"\n                    }\n                  ]\n                }\n              }\n            ],\n            \"system\": \"https://fhir.nhs.uk/Id/nhs-number\",\n            \"value\": \"9435492908\"\n          }\n        ],\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"family\": \"AZIZ\",\n            \"given\": [\n              \"NISMA\"\n            ]\n          }\n        ],\n        \"gender\": \"female\",\n        \"birthDate\": \"1945-07-30\",\n        \"address\": [\n          {\n            \"line\": [\n              \"FLAT1\",\n              \"59 SANDTOFT ROAD\",\n              \"LEEDS\"\n            ],\n            \"postalCode\": \"DN9 1PJ\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:4e922a51-b10c-4ab2-91f5-030747565916\",\n      \"resource\": {\n        \"resourceType\": \"Practitioner\",\n        \"id\": \"4e922a51-b10c-4ab2-91f5-030747565916\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"value\": \"G3380314\"\n          }\n        ],\n        \"name\": [\n          {\n            \"text\": \"SCOTT\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\",\n      \"resource\": {\n        \"resourceType\": \"Organization\",\n        \"id\": \"beb49b07-181a-4e90-9f6e-ede822162bc5\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1\"\n          ]\n        },\n        \"name\": \"NORTH DOWN GP\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\",\n      \"resource\": {\n        \"resourceType\": \"Practitioner\",\n        \"id\": \"93c6e8be-1f00-4364-9f82-1afaf7ebdde6\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1\"\n          ]\n        }\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\",\n      \"resource\": {\n        \"resourceType\": \"Organization\",\n        \"id\": \"6ac07330-fd7a-4f71-840c-007c247c569b\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1\"\n          ]\n        },\n        \"type\": [\n          {\n            \"coding\": [\n              {\n                \"code\": \"dept\",\n                \"display\": \"Haematology\"\n              }\n            ]\n          }\n        ],\n        \"name\": \"ST JAMES'S UNIVERSITY HOSPITAL\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:3b56bc6b-2b7a-48e8-91fd-a712d5981820\",\n      \"resource\": {\n        \"resourceType\": \"ProcedureRequest\",\n        \"id\": \"3b56bc6b-2b7a-48e8-91fd-a712d5981820\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-ProcedureRequest-1\"\n          ]\n        },\n        \"status\": \"active\",\n        \"intent\": \"order\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"code\": \"15220000\",\n              \"display\": \"Laboratory test (procedure)\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"requester\": {\n          \"agent\": {\n            \"reference\": \"urn:uuid:4e922a51-b10c-4ab2-91f5-030747565916\"\n          },\n          \"onBehalfOf\": {\n            \"reference\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\"\n          }\n        },\n        \"performer\": {\n          \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n        },\n        \"note\": [\n          {\n            \"text\": \"TIRED ALL THE TIME, LOW Hb\"\n          },\n          {\n            \"text\": \"COELIAC\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\",\n      \"resource\": {\n        \"resourceType\": \"DiagnosticReport\",\n        \"id\": \"1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-DiagnosticReport-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://tools.ietf.org/html/rfc4122\",\n            \"value\": \"15/CH000037K/200010191704\"\n          }\n        ],\n        \"basedOn\": [\n          {\n            \"reference\": \"urn:uuid:3b56bc6b-2b7a-48e8-91fd-a712d5981820\"\n          }\n        ],\n        \"status\": \"unknown\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"code\": \"721981007\",\n              \"display\": \"Diagnostic studies report\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"issued\": \"2010-02-25T15:41:00.000+00:00\",\n        \"performer\": [\n          {\n            \"actor\": {\n              \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n            }\n          },\n          {\n            \"actor\": {\n              \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n            }\n          }\n        ],\n        \"specimen\": [\n          {\n            \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n          }\n        ],\n        \"result\": [\n          {\n            \"reference\": \"urn:uuid:2cafce94-1cca-4356-86e3-a081c26db835\"\n          },\n          {\n            \"reference\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\"\n          },\n          {\n            \"reference\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\",\n      \"resource\": {\n        \"resourceType\": \"Specimen\",\n        \"id\": \"3b6d2760-37a8-471e-a00a-b2627bb5e74c\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Specimen-1\"\n          ]\n        },\n        \"accessionIdentifier\": {\n          \"value\": \"CH000037KA\"\n        },\n        \"type\": {\n          \"coding\": [\n            {\n              \"display\": \"VENOUS BLOOD\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"receivedTime\": \"2010-02-24T15:41:00+00:00\",\n        \"collection\": {\n          \"collectedDateTime\": \"2010-02-23T15:41:00+00:00\"\n        }\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:2cafce94-1cca-4356-86e3-a081c26db835\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"2cafce94-1cca-4356-86e3-a081c26db835\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"display\": \"B12/FOLATE\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"comment\": \"Results repeated Low plasma Folate\",\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"related\": [\n          {\n            \"type\": \"has-member\",\n            \"target\": {\n              \"reference\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\"\n            }\n          },\n          {\n            \"type\": \"has-member\",\n            \"target\": {\n              \"reference\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"4a8faf9a-37f0-4e3a-852a-dfc66207b486\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://read.info/readv2\",\n              \"code\": \"42T..\",\n              \"display\": \"Serum vitamin B12\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"valueQuantity\": {\n          \"value\": 1001,\n          \"unit\": \"ng/L\"\n        },\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"referenceRange\": [\n          {\n            \"low\": {\n              \"value\": 170\n            },\n            \"high\": {\n              \"value\": 1100\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"f699a365-6bf0-4089-8718-06198aa7c40b\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://read.info/readv2\",\n              \"code\": \"42UE.\",\n              \"display\": \"Plasma folate level\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"interpretation\": {\n          \"coding\": [\n            {\n              \"code\": \"PA\",\n              \"display\": \"Potentially abnormal\"\n            }\n          ]\n        },\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"referenceRange\": [\n          {\n            \"low\": {\n              \"value\": 2.0\n            },\n            \"high\": {\n              \"value\": 20.0\n            }\n          }\n        ]\n      }\n    }\n  ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8161/api/message/lab_results_gp_outbound?type=queue",
							"host": [
								"localhost"
							],
							"port": "8161",
							"path": [
								"api",
								"message",
								"lab_results_gp_outbound"
							],
							"query": [
								{
									"key": "type",
									"value": "queue"
								}
							]
						},
						"description": "# Description\n\nSends a message to the lab results GP outbound queue, this endpoint will not really need to be used unless for purposes such as testing.\n\n# Headers\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| Content-Type | Type of the message. This is `application/json`. |\n\n# Example Body\n\n``` json\n{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"6599daf3-aa70-4df5-bafb-e9318c6bc988\",\n  \"meta\": {\n    \"lastUpdated\": \"2025-04-01T14:39:42.614+00:00\",\n    \"profile\": [\n      \"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Message-Bundle-1\"\n    ]\n  },\n  \"identifier\": {\n    \"system\": \"https://tools.ietf.org/html/rfc4122\",\n    \"value\": \"edcdcbbe-1cbb-43ed-b7e9-517234048edc\"\n  },\n  \"type\": \"message\",\n  \"entry\": [\n    {\n      \"fullUrl\": \"urn:uuid:41b62b9f-e797-4f1a-ba47-1265dd53d187\",\n      \"resource\": {\n        \"resourceType\": \"MessageHeader\",\n        \"id\": \"41b62b9f-e797-4f1a-ba47-1265dd53d187\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-MessageHeader-2\"\n          ]\n        },\n        \"extension\": [\n          {\n            \"url\": \"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-ITK-MessageHandling-2\",\n            \"extension\": [\n              {\n                \"url\": \"BusAckRequested\",\n                \"valueBoolean\": true\n              },\n              {\n                \"url\": \"InfAckRequested\",\n                \"valueBoolean\": true\n              },\n              {\n                \"url\": \"RecipientType\",\n                \"valueCoding\": {\n                  \"system\": \"https://fhir.nhs.uk/STU3/CodeSystem/ITK-RecipientType-1\",\n                  \"code\": \"FA\",\n                  \"display\": \"For Action\"\n                }\n              },\n              {\n                \"url\": \"SenderReference\",\n                \"valueString\": \"None\"\n              },\n              {\n                \"url\": \"LocalExtension\",\n                \"valueString\": \"None\"\n              }\n            ]\n          }\n        ],\n        \"event\": {\n          \"system\": \"https://fhir.nhs.uk/STU3/CodeSystem/ITK-MessageEvent-2\",\n          \"code\": \"ITK012M\",\n          \"display\": \"ITK National Pathology\"\n        },\n        \"receiver\": {\n          \"reference\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\"\n        },\n        \"sender\": {\n          \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n        },\n        \"timestamp\": \"2010-03-01T17:51:00.000+00:00\",\n        \"source\": {\n          \"endpoint\": \"lab_results_ack_mailbox\"\n        },\n        \"responsible\": {\n          \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n        },\n        \"focus\": [\n          {\n            \"reference\": \"urn:uuid:1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"7487dc19-414a-416a-a795-cb98ecccacd6\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"extension\": [\n              {\n                \"url\": \"https://fhir.hl7.org.uk/STU3/StructureDefinition/Extension-CareConnect-NHSNumberVerificationStatus-1\",\n                \"valueCodeableConcept\": {\n                  \"coding\": [\n                    {\n                      \"system\": \"https://fhir.hl7.org.uk/STU3/CodeSystem/CareConnect-NHSNumberVerificationStatus-1\",\n                      \"code\": \"01\",\n                      \"display\": \"Number present and verified\"\n                    }\n                  ]\n                }\n              }\n            ],\n            \"system\": \"https://fhir.nhs.uk/Id/nhs-number\",\n            \"value\": \"9435492908\"\n          }\n        ],\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"family\": \"AZIZ\",\n            \"given\": [\n              \"NISMA\"\n            ]\n          }\n        ],\n        \"gender\": \"female\",\n        \"birthDate\": \"1945-07-30\",\n        \"address\": [\n          {\n            \"line\": [\n              \"FLAT1\",\n              \"59 SANDTOFT ROAD\",\n              \"LEEDS\"\n            ],\n            \"postalCode\": \"DN9 1PJ\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:4e922a51-b10c-4ab2-91f5-030747565916\",\n      \"resource\": {\n        \"resourceType\": \"Practitioner\",\n        \"id\": \"4e922a51-b10c-4ab2-91f5-030747565916\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"value\": \"G3380314\"\n          }\n        ],\n        \"name\": [\n          {\n            \"text\": \"SCOTT\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\",\n      \"resource\": {\n        \"resourceType\": \"Organization\",\n        \"id\": \"beb49b07-181a-4e90-9f6e-ede822162bc5\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1\"\n          ]\n        },\n        \"name\": \"NORTH DOWN GP\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\",\n      \"resource\": {\n        \"resourceType\": \"Practitioner\",\n        \"id\": \"93c6e8be-1f00-4364-9f82-1afaf7ebdde6\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1\"\n          ]\n        }\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\",\n      \"resource\": {\n        \"resourceType\": \"Organization\",\n        \"id\": \"6ac07330-fd7a-4f71-840c-007c247c569b\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1\"\n          ]\n        },\n        \"type\": [\n          {\n            \"coding\": [\n              {\n                \"code\": \"dept\",\n                \"display\": \"Haematology\"\n              }\n            ]\n          }\n        ],\n        \"name\": \"ST JAMES'S UNIVERSITY HOSPITAL\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:3b56bc6b-2b7a-48e8-91fd-a712d5981820\",\n      \"resource\": {\n        \"resourceType\": \"ProcedureRequest\",\n        \"id\": \"3b56bc6b-2b7a-48e8-91fd-a712d5981820\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-ProcedureRequest-1\"\n          ]\n        },\n        \"status\": \"active\",\n        \"intent\": \"order\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"code\": \"15220000\",\n              \"display\": \"Laboratory test (procedure)\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"requester\": {\n          \"agent\": {\n            \"reference\": \"urn:uuid:4e922a51-b10c-4ab2-91f5-030747565916\"\n          },\n          \"onBehalfOf\": {\n            \"reference\": \"urn:uuid:beb49b07-181a-4e90-9f6e-ede822162bc5\"\n          }\n        },\n        \"performer\": {\n          \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n        },\n        \"note\": [\n          {\n            \"text\": \"TIRED ALL THE TIME, LOW Hb\"\n          },\n          {\n            \"text\": \"COELIAC\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\",\n      \"resource\": {\n        \"resourceType\": \"DiagnosticReport\",\n        \"id\": \"1a36951a-1e0d-4ea2-bae2-1b7e70d80d6a\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-DiagnosticReport-1\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://tools.ietf.org/html/rfc4122\",\n            \"value\": \"15/CH000037K/200010191704\"\n          }\n        ],\n        \"basedOn\": [\n          {\n            \"reference\": \"urn:uuid:3b56bc6b-2b7a-48e8-91fd-a712d5981820\"\n          }\n        ],\n        \"status\": \"unknown\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"code\": \"721981007\",\n              \"display\": \"Diagnostic studies report\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"issued\": \"2010-02-25T15:41:00.000+00:00\",\n        \"performer\": [\n          {\n            \"actor\": {\n              \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n            }\n          },\n          {\n            \"actor\": {\n              \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n            }\n          }\n        ],\n        \"specimen\": [\n          {\n            \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n          }\n        ],\n        \"result\": [\n          {\n            \"reference\": \"urn:uuid:2cafce94-1cca-4356-86e3-a081c26db835\"\n          },\n          {\n            \"reference\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\"\n          },\n          {\n            \"reference\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\"\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\",\n      \"resource\": {\n        \"resourceType\": \"Specimen\",\n        \"id\": \"3b6d2760-37a8-471e-a00a-b2627bb5e74c\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Specimen-1\"\n          ]\n        },\n        \"accessionIdentifier\": {\n          \"value\": \"CH000037KA\"\n        },\n        \"type\": {\n          \"coding\": [\n            {\n              \"display\": \"VENOUS BLOOD\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"receivedTime\": \"2010-02-24T15:41:00+00:00\",\n        \"collection\": {\n          \"collectedDateTime\": \"2010-02-23T15:41:00+00:00\"\n        }\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:2cafce94-1cca-4356-86e3-a081c26db835\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"2cafce94-1cca-4356-86e3-a081c26db835\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"display\": \"B12/FOLATE\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"comment\": \"Results repeated Low plasma Folate\",\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"related\": [\n          {\n            \"type\": \"has-member\",\n            \"target\": {\n              \"reference\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\"\n            }\n          },\n          {\n            \"type\": \"has-member\",\n            \"target\": {\n              \"reference\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:4a8faf9a-37f0-4e3a-852a-dfc66207b486\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"4a8faf9a-37f0-4e3a-852a-dfc66207b486\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://read.info/readv2\",\n              \"code\": \"42T..\",\n              \"display\": \"Serum vitamin B12\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"valueQuantity\": {\n          \"value\": 1001,\n          \"unit\": \"ng/L\"\n        },\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"referenceRange\": [\n          {\n            \"low\": {\n              \"value\": 170\n            },\n            \"high\": {\n              \"value\": 1100\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:f699a365-6bf0-4089-8718-06198aa7c40b\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"f699a365-6bf0-4089-8718-06198aa7c40b\",\n        \"meta\": {\n          \"profile\": [\n            \"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"system\": \"http://read.info/readv2\",\n              \"code\": \"42UE.\",\n              \"display\": \"Plasma folate level\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:7487dc19-414a-416a-a795-cb98ecccacd6\"\n        },\n        \"performer\": [\n          {\n            \"reference\": \"urn:uuid:6ac07330-fd7a-4f71-840c-007c247c569b\"\n          },\n          {\n            \"reference\": \"urn:uuid:93c6e8be-1f00-4364-9f82-1afaf7ebdde6\"\n          }\n        ],\n        \"interpretation\": {\n          \"coding\": [\n            {\n              \"code\": \"PA\",\n              \"display\": \"Potentially abnormal\"\n            }\n          ]\n        },\n        \"specimen\": {\n          \"reference\": \"urn:uuid:3b6d2760-37a8-471e-a00a-b2627bb5e74c\"\n        },\n        \"referenceRange\": [\n          {\n            \"low\": {\n              \"value\": 2.0\n            },\n            \"high\": {\n              \"value\": 20.0\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n\n ```\n\n# Example Response\n\n``` json\nMessage sent\n\n ```\n\nMessage sent confirmation with 200 OK response."
					},
					"response": []
				},
				{
					"name": "View ActiveMQ Message",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const xml2js = require('xml2js');",
									"xml2js.parseString(pm.response.text(), function (err, result) {",
									"    if (result['org.apache.activemq.command.ActiveMQBytesMessage']) {",
									"        encodedString = result['org.apache.activemq.command.ActiveMQBytesMessage'].content[0].data;",
									"    } else if (result['org.apache.activemq.command.ActiveMQTextMessage']) {",
									"        encodedString = result['org.apache.activemq.command.ActiveMQTextMessage'].content[0].data;",
									"    } else {",
									"        console.log(\"Error: Message does not exist.\")",
									"        return;",
									"    }",
									"    decodedString = atob(encodedString);",
									"    console.log(decodedString);",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8161/admin/queueBrowse/lab_results_gp_outbound?msgId=ID:7b947839afc1-43237-1743611581295-7:2:1:1:5",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8161",
							"path": [
								"admin",
								"queueBrowse",
								"lab_results_gp_outbound"
							],
							"query": [
								{
									"key": "msgId",
									"value": "ID:7b947839afc1-43237-1743611581295-7:2:1:1:5"
								}
							]
						},
						"description": "# Description\n\nView a message with a corresponding message ID from the Lab Results GP Outbound queue. This endpoint will **not** consume or remove the message from the queue, it is only for viewing the message.\n\nThe XML version (confirm if it is XML?) can be seen in the body of the response.\n\nThe FHIR version can be seen in the Postman console (available on the bottom left of Postman UI).\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| msgId | The msgId can be retrieved by accessing the lab_results_gp_outbound queue via ActiveMQ. |\n\n<img src=\"https://content.pstmn.io/e03d0a84-e426-460b-bcad-bd5928500ab0/aW1hZ2UucG5n\" alt=\"Message%20ID%20is%20the%20first%20column%20when%20browsing%20the%20lab%20results%20GP%20outbound%20queue%20via%20ActiveMQ%20in%20browser.\" width=\"1453\" height=\"432\">"
					},
					"response": []
				},
				{
					"name": "ActiveMQ Retrieve Message",
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8161/api/message/lab_results_gp_outbound?type=queue&clientId=postman-client&subId=postman-sub&json=true&msgId=ID:7b947839afc1-43237-1743611581295-7:2:1:1:5",
							"host": [
								"localhost"
							],
							"port": "8161",
							"path": [
								"api",
								"message",
								"lab_results_gp_outbound"
							],
							"query": [
								{
									"key": "type",
									"value": "queue"
								},
								{
									"key": "clientId",
									"value": "postman-client"
								},
								{
									"key": "subId",
									"value": "postman-sub"
								},
								{
									"key": "json",
									"value": "true"
								},
								{
									"key": "msgId",
									"value": "ID:7b947839afc1-43237-1743611581295-7:2:1:1:5"
								}
							]
						},
						"description": "# Description\n\nRetrieve a message from the Lab Results GP Outbound queue. This endpoint will **CONSUME/REMOVE** the message from the queue.\n\nFor viewing the message only, use the alternative View ActiveMQ Message endpoint.\n\n# Parameters\n\n| **Parameter** | **Explanation** |\n| --- | --- |\n| msgId | The message ID can be retrieved by accessing the lab_results_gp_outbound queue via ActiveMQ. |\n\n<img src=\"https://content.pstmn.io/e03d0a84-e426-460b-bcad-bd5928500ab0/aW1hZ2UucG5n\" alt=\"Message%20ID%20is%20the%20first%20column%20when%20browsing%20the%20lab%20results%20GP%20outbound%20queue%20via%20ActiveMQ%20in%20browser.\" width=\"1453\" height=\"432\">"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		}
	]
}